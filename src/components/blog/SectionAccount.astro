---
// Importaciones
import {IconLogout, IconDots, IconStar} from "@tabler/icons-react";
import {SignOut} from "auth-astro/components";
import {getSession} from "auth-astro/server";

const session = await getSession(Astro.request);
---

<div class="relative rounded-md border-2 border-white/20 bg-white/5 p-3">
    <div class="absolute right-0 top-0 m-3">
        <button id="menuButton"
            class="dropdown-button rounded-md border-white/40 bg-white/5 px-1 py-1 text-white/50 transition-all hover:bg-white/10 hover:text-white">
            <IconDots width={16} height={16} />
        </button>
        <div id="dropdownMenu"
            class="absolute right-0 z-10 mt-2 hidden w-40 rounded-md border-2 border-white/20 bg-white/5 p-1 shadow-xl backdrop-blur">
            <a href="#"
                class="flex w-full items-center justify-between rounded-md px-2.5 py-2 text-sm text-white/50 transition-all hover:bg-yellow-500/5 hover:text-yellow-500">Posts
                favoritos
                <IconStar width={16} height={16} />
            </a>
            <SignOut
                class="flex w-full items-center justify-between rounded-md px-2.5 py-2 text-sm text-white/50 transition-all hover:bg-red-500/5 hover:text-red-500">
                Cerrar sesi√≥n
                <IconLogout width={16} height={16} />
            </SignOut>
        </div>
    </div>
    <div class="flex items-center space-x-2">
        <img class="h-12 w-12 rounded-md" src={session?.user?.image} alt=`foto de perfil de ${session?.user?.name}` />
        <div class="text-left">
            <p class="text-sm font-bold">{session?.user?.name}</p>
            <p class="text-xs text-gray-400">{session?.user?.email}</p>
        </div>
    </div>
</div>

<style>
    #dropdownMenu.open {
        animation: scale-up-center 0.1s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
    }
  
    @keyframes scale-up-center {
      from {
        transform: scale(0.5);
        opacity: 1;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
  </style>

<script>
    document.addEventListener(
        "astro:page-load",
        () => {
            const button = document.getElementById("menuButton");
            const menu = document.getElementById("dropdownMenu");

            if (menu && button) {
                button.addEventListener("click", function (event) {
                    menu.classList.toggle("hidden");
                    menu.classList.toggle("open");
                    event.stopPropagation();
                });

                document.addEventListener("click", function () {
                    if (menu && !menu.classList.contains("hidden")) {
                        menu.classList.add("hidden");
                        menu.classList.remove("open");
                    }
                });

                menu.addEventListener("click", function (event) {
                    menu.classList.add("hidden");
                    menu.classList.remove("open");
                    event.stopPropagation();
                });
            }
        },
        { once: false },
    );
</script>